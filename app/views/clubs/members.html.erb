<% content_for :title, "#{@club.name} - Members" %>

<div class="w-full md:mt-8">
  <!-- Page header -->
  <div class="w-full">
    <div class="w-full">
      <%= render partial: 'shared/breadcrumbs', locals: {
        links_and_text: [
          [clubs_path, "Clubs"], [club_path(@club), truncate(@club.name, length: 20)], [club_membership_path(@club), "All members"]
        ]
      } %>
    </div>

    <div class="w-full flex mt-4 justify-between items-center">
      <div class="col-span-4 lg:col-span-3 mb-4">
        <h1 class="text-3xl font-bold tracking-tight">Manage Members</h1>
      </div>

      <%= link_to my_clubs_path, class: "inline-flex items-center rounded-md bg-orange-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2" do %>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="mr-2 h-5 w-5">
          <path fill-rule="evenodd" d="M7.72 12.53a.75.75 0 010-1.06l7.5-7.5a.75.75 0 111.06 1.06L9.31 12l6.97 6.97a.75.75 0 11-1.06 1.06l-7.5-7.5z" clip-rule="evenodd" />
        </svg>
        Back to my Clubs
      <% end %>
    </div>
  </div>

  <!-- Tabs -->
  <div data-controller="tabs" data-tabs-default-tab-value="active">
    <div class="border-b border-gray-200 dark:border-gray-700">
      <nav class="-mb-px flex space-x-8 overflow-scroll" aria-label="Tabs">
        <a href="#active" data-tab-name="active" data-tabs-target="tab" data-action="click->tabs#select" class="border-orange-500 text-orange-600 dark:text-orange-400 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium cursor-pointer">
          Active
          <span class="ml-2 rounded-full bg-gray-100 dark:bg-gray-700 px-2.5 py-0.5 text-xs font-medium text-gray-900 dark:text-gray-100"><%= @active_members.count %></span>
        </a>
        <a href="#pending" data-tab-name="pending" data-tabs-target="tab" data-action="click->tabs#select" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium cursor-pointer">
          Pending Approval
          <span class="ml-2 rounded-full bg-gray-100 dark:bg-gray-700 px-2.5 py-0.5 text-xs font-medium text-gray-900 dark:text-gray-100"><%= @pending_members.count %></span>
        </a>
        <a href="#disabled" data-tab-name="disabled" data-tabs-target="tab" data-action="click->tabs#select" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium cursor-pointer">
          Disabled
          <span class="ml-2 rounded-full bg-gray-100 dark:bg-gray-700 px-2.5 py-0.5 text-xs font-medium text-gray-900 dark:text-gray-100"><%= @disabled_members.count %></span>
        </a>
      </nav>
    </div>

    <!-- Tab Content -->
    <div class="mt-6">
    <!-- Active Members Tab -->
    <div id="active-content" data-tab-name="active" data-tabs-target="panel">
      <% if @active_members.present? %>
        <div class="overflow-hidden bg-white shadow dark:bg-gray-800 sm:rounded-md">
          <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
            <% @active_members.each do |membership| %>
              <li class="px-4 py-4 sm:px-6">
                <div class="flex items-center justify-between">
                  <div class="flex items-center min-w-0 flex-1">
                    <div class="min-w-0 flex-1">
                      <div class="flex items-center gap-3">
                        <p class="text-sm font-semibold text-gray-900 dark:text-gray-100">
                          <%= membership.user.first_name %> <%= membership.user.last_name %>
                        </p>
                        <span class="inline-flex items-center rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-700 dark:bg-green-900/50 dark:text-green-300">Active</span>
                      </div>
                      <p class="mt-1 text-sm text-gray-600 dark:text-gray-300"><%= membership.user.email %></p>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Member for <%= time_ago_in_words(membership.created_at) %></p>
                    </div>
                  </div>
                  <div class="ml-4 flex flex-shrink-0 gap-2">
                    <%= button_to "Disable", disable_club_membership_path(@club, membership), method: :patch,
                        data: { turbo_confirm: "Are you sure you want to disable #{membership.user.first_name}?" },
                        class: "inline-flex items-center rounded-md border border-yellow-300 bg-yellow-50 px-3 py-1.5 text-sm font-medium text-yellow-800 hover:bg-yellow-500 hover:text-white dark:border-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-300" %>
                    <%= button_to "Remove", club_membership_path(@club), method: :delete, params: { membership_id: membership.id },
                        data: { turbo_confirm: "Are you sure you want to remove #{membership.user.first_name} from the club? THIS ACTION CANNOT BE UNDONE" },
                        class: "inline-flex items-center rounded-md bg-red-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-red-700" %>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        </div>
      <% else %>
        <div class="text-center py-12">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          <h3 class="mt-2 text-sm font-semibold text-gray-900 dark:text-gray-100">No active members</h3>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Share your club to get members!</p>
        </div>
      <% end %>
    </div>

    <!-- Pending Members Tab -->
    <div id="pending-content" data-tab-name="pending" data-tabs-target="panel" class="hidden">
      <% if @pending_members.present? %>
        <div class="overflow-hidden bg-white shadow dark:bg-gray-800 sm:rounded-md">
          <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
            <% @pending_members.each do |membership| %>
              <li class="px-4 py-4 sm:px-6">
                <div class="flex items-center justify-between">
                  <div class="flex items-center min-w-0 flex-1">
                    <div class="min-w-0 flex-1">
                      <div class="flex items-center gap-3">
                        <p class="text-sm font-semibold text-gray-900 dark:text-gray-100">
                          <%= membership.user.first_name %> <%= membership.user.last_name %>
                        </p>
                        <span class="inline-flex items-center rounded-full bg-yellow-100 px-2 py-0.5 text-xs font-medium text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-300">Pending</span>
                      </div>
                      <p class="mt-1 text-sm text-gray-600 dark:text-gray-300"><%= membership.user.email %></p>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Requested <%= time_ago_in_words(membership.created_at) %> ago</p>
                    </div>
                  </div>
                  <div class="ml-4 flex flex-shrink-0 gap-2">
                    <%= button_to "Approve", approve_club_membership_path(@club, membership), method: :patch,
                        class: "inline-flex items-center rounded-md bg-green-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-green-700" %>
                    <%= button_to "Reject", club_membership_path(@club), method: :delete, params: { membership_id: membership.id },
                        data: { turbo_confirm: "Are you sure you want to reject #{membership.user.first_name}'s request?" },
                        class: "inline-flex items-center rounded-md border border-gray-300 px-3 py-1.5 text-sm font-medium text-gray-900 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-100 dark:hover:bg-gray-700" %>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        </div>
      <% else %>
        <div class="text-center py-12">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <h3 class="mt-2 text-sm font-semibold text-gray-900 dark:text-gray-100">No pending requests</h3>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">No members are waiting for approval.</p>
        </div>
      <% end %>
    </div>

    <!-- Disabled Members Tab -->
    <div id="disabled-content" data-tab-name="disabled" data-tabs-target="panel" class="hidden">
      <% if @disabled_members.present? %>
        <div class="overflow-hidden bg-white shadow dark:bg-gray-800 sm:rounded-md">
          <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
            <% @disabled_members.each do |membership| %>
              <li class="px-4 py-4 sm:px-6">
                <div class="flex items-center justify-between">
                  <div class="flex items-center min-w-0 flex-1">
                    <div class="min-w-0 flex-1">
                      <div class="flex items-center gap-3">
                        <p class="text-sm font-semibold text-gray-900 dark:text-gray-100">
                          <%= membership.user.first_name %> <%= membership.user.last_name %>
                        </p>
                        <span class="inline-flex items-center rounded-full bg-gray-400 px-2 py-0.5 text-xs font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-300">Disabled</span>
                      </div>
                      <p class="mt-1 text-sm text-gray-600 dark:text-gray-300"><%= membership.user.email %></p>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Disabled <%= time_ago_in_words(membership.updated_at) %> ago</p>
                    </div>
                  </div>
                  <div class="ml-4 flex flex-shrink-0 gap-2">
                    <%= button_to "Enable", enable_club_membership_path(@club, membership), method: :patch,
                        class: "inline-flex items-center rounded-md bg-green-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-green-700" %>
                    <%= button_to "Remove", club_membership_path(@club), method: :delete, params: { membership_id: membership.id },
                        data: { turbo_confirm: "Are you sure you want to remove #{membership.user.first_name} from the club? THIS ACTION CANNOT BE UNDONE" },
                        class: "inline-flex items-center rounded-md bg-red-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-red-700" %>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        </div>
      <% else %>
        <div class="text-center py-12">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
          </svg>
          <h3 class="mt-2 text-sm font-semibold text-gray-900 dark:text-gray-100">No disabled members</h3>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">You have no disabled members.</p>
        </div>
      <% end %>
    </div>
    </div>
  </div>
</div>
