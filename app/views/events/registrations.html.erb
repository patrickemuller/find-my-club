<% content_for :title, "#{@event.name} - Registrations" %>

<div class="mx-auto w-full md:mt-8">
  <div class="mb-6">
    <h1 class="text-3xl font-bold tracking-tight">Manage Registrations</h1>
    <p class="mt-1 text-sm text-gray-600 dark:text-gray-300"><%= @event.name %></p>
  </div>

  <div data-controller="tabs" data-tabs-default-tab-value="confirmed">
    <!-- Tabs -->
    <div class="border-b border-gray-200 dark:border-gray-700">
      <nav class="-mb-px flex space-x-8">
        <a href="#confirmed" data-tab-name="confirmed" data-tabs-target="tab" data-action="click->tabs#select" class="border-orange-500 text-orange-600 dark:text-orange-400 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium cursor-pointer">
          Confirmed
          <span class="ml-2 rounded-full bg-gray-100 dark:bg-gray-700 px-2.5 py-0.5 text-xs font-medium text-gray-900 dark:text-gray-100"><%= @confirmed_registrations.count %></span>
        </a>
        <a href="#waitlist" data-tab-name="waitlist" data-tabs-target="tab" data-action="click->tabs#select" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium cursor-pointer">
          Waitlist
          <span class="ml-2 rounded-full bg-gray-100 dark:bg-gray-700 px-2.5 py-0.5 text-xs font-medium text-gray-900 dark:text-gray-100"><%= @waitlist_registrations.count %></span>
        </a>
      </nav>
    </div>

    <!-- Confirmed Tab -->
    <div id="confirmed-content" data-tab-name="confirmed" data-tabs-target="panel" class="mt-6">
      <% if @confirmed_registrations.present? %>
        <div class="overflow-hidden bg-white shadow dark:bg-gray-800 sm:rounded-md">
          <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
            <% @confirmed_registrations.each do |registration| %>
              <li class="px-4 py-4 sm:px-6">
                <div class="flex items-center justify-between">
                  <div class="flex items-center min-w-0 flex-1">
                    <div>
                      <p class="text-sm font-semibold text-gray-900 dark:text-gray-100">
                        <%= registration.user.first_name %> <%= registration.user.last_name %>
                      </p>
                      <p class="mt-1 text-sm text-gray-600 dark:text-gray-300"><%= registration.user.email %></p>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Registered <%= time_ago_in_words(registration.created_at) %> ago</p>
                    </div>
                  </div>
                  <div class="ml-4">
                    <%= button_to "Remove", club_event_event_registration_path(@club, @event, registration), method: :delete, data: { turbo_confirm: "Remove #{registration.user.first_name} from this event?" }, class: "inline-flex items-center rounded-md bg-red-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-red-700" %>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        </div>
      <% else %>
        <div class="text-center py-12">
          <p class="text-gray-500 dark:text-gray-400">No confirmed registrations yet</p>
        </div>
      <% end %>
    </div>

    <!-- Waitlist Tab -->
    <div id="waitlist-content" data-tab-name="waitlist" data-tabs-target="panel" class="mt-6 hidden">
      <% if @waitlist_registrations.present? %>
        <div class="overflow-hidden bg-white shadow dark:bg-gray-800 sm:rounded-md">
          <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
            <% @waitlist_registrations.each do |registration| %>
              <li class="px-4 py-4 sm:px-6 bg-yellow-50 dark:bg-yellow-900/10">
                <div class="flex items-center justify-between">
                  <div class="flex items-center min-w-0 flex-1">
                    <div>
                      <p class="text-sm font-semibold text-gray-900 dark:text-gray-100">
                        <%= registration.user.first_name %> <%= registration.user.last_name %>
                      </p>
                      <p class="mt-1 text-sm text-gray-600 dark:text-gray-300"><%= registration.user.email %></p>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Joined waitlist <%= time_ago_in_words(registration.created_at) %> ago</p>
                    </div>
                  </div>
                  <div class="ml-4 flex gap-2">
                    <%= button_to "Approve", approve_club_event_event_registration_path(@club, @event, registration), method: :patch, class: "inline-flex items-center rounded-md bg-green-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-green-700" %>
                    <%= button_to "Remove", club_event_event_registration_path(@club, @event, registration), method: :delete, data: { turbo_confirm: "Remove #{registration.user.first_name} from waitlist?" }, class: "inline-flex items-center rounded-md border border-gray-300 px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-700" %>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        </div>
      <% else %>
        <div class="text-center py-12">
          <p class="text-gray-500 dark:text-gray-400">No one on the waitlist</p>
        </div>
      <% end %>
    </div>
  </div>

  <div class="mt-6">
    <%= link_to "â† Back to Event", club_event_path(@club, @event), class: "text-orange-600 hover:underline" %>
  </div>
</div>
